---
import type { Depth } from "../../stores/depthStore";

interface Props {
  innerText: Record<Depth, string[]>;
}

const { innerText } = Astro.props;

---

<div class="content-switcher-content relative">
  <div class="content-variant hidden opacity-0 transition-opacity duration-300 ease-in-out [&.active]:block [&.active]:opacity-100 [&.active]:animate-content-enter" data-depth="non-technical">
    {
      innerText["non-technical"].map((text) => (
        <p
          class="text-sm text-neutral-700 dark:text-neutral-300 leading-relaxed m-0 mb-3"
          set:html={text}
        />
      ))
    }
  </div>

  <div class="content-variant hidden opacity-0 transition-opacity duration-300 ease-in-out [&.active]:block [&.active]:opacity-100 [&.active]:animate-content-enter" data-depth="technical">
    {
      innerText.technical.map((text) => (
        <p
          class="text-sm text-neutral-700 dark:text-neutral-300 leading-relaxed m-0 mb-3"
          set:html={text}
        />
      ))
    }
  </div>

  <div class="content-variant hidden opacity-0 transition-opacity duration-300 ease-in-out [&.active]:block [&.active]:opacity-100 [&.active]:animate-content-enter" data-depth="deep">
    {
      innerText.deep.map((text) => (
        <p
          class="text-sm text-neutral-700 dark:text-neutral-300 leading-relaxed m-0 mb-3"
          set:html={text}
        />
      ))
    }
  </div>
</div>

<script>
  import { depthStore } from "../../stores/depthStore";

  // Initialize all content switchers on the page
  function initContentSwitchers() {
    const switchers = document.querySelectorAll(".content-switcher-content");

    switchers.forEach((switcher) => {
      const variants = switcher.querySelectorAll(".content-variant");

      // Set initial depth
      const currentDepth = depthStore.get();
      variants.forEach((variant) => {
        if (variant.getAttribute("data-depth") === currentDepth) {
          variant.classList.add("active");
        }
      });

      // Subscribe to depth changes
      depthStore.subscribe((depth) => {
        variants.forEach((variant) => {
          if (variant.getAttribute("data-depth") === depth) {
            variant.classList.add("active");
          } else {
            variant.classList.remove("active");
          }
        });
      });
    });
  }

  // Run on initial load
  initContentSwitchers();

  // Re-run after page navigation (for view transitions)
  document.addEventListener("astro:page-load", initContentSwitchers);
</script>
