---
import { getCollection } from "astro:content";
import "../styles/global.css";
import Sidebar from "../components/react/sidebar";
import Footer from "../components/layout/footer.astro";

// Fetch unique sections for sidebar
const zeroTrustEntries = await getCollection("products", ({ data }) => {
  return data.product === "zero-trust";
});

const { hasContent = true } = Astro.props;

// Get unique sections sorted by order
const sections = new Map();
zeroTrustEntries.forEach((entry) => {
  const { id, badgeTitle, order } = entry.data.section;
  if (!sections.has(id)) {
    sections.set(id, { id, badgeTitle, order });
  }
});

const ztnaCopy = Array.from(sections.values()).sort(
  (a, b) => a.order - b.order
);
---

<body
  class="min-h-screen flex text-neutral-900 dark:text-neutral-100 dark:bg-neutral-950"
>
  <Sidebar
    hasContent={hasContent}
    client:load
    items={[
      { id: "overview", label: "Overview" },
      ...ztnaCopy.map((section) => ({
        id: section.id,
        label: section.badgeTitle,
      })),
    ]}
  />
  <div class="flex-1 overflow-x-hidden">
    <main class="min-h-screen">
      <div class="">
        <slot />
      </div>
    </main>
    <Footer />
  </div>

  <script>
    if (window.location.hash) {
      const hash = window.location.hash.slice(1);

      const scrollToHash = () => {
        const element = document.getElementById(hash);
        if (element) {
          element.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      };

      if (document.readyState === "complete") {
        setTimeout(scrollToHash, 100);
      } else {
        window.addEventListener("load", () => {
          setTimeout(scrollToHash, 100);
        });
      }
    }
  </script>
</body>
